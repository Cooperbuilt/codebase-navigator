# Service Map

> This file is auto-generated by `/setup` and can be manually edited.
> It describes how services connect and data flows through the system.

## Service Dependency Overview

```
[Client Browser]
       ↓
[CloudFront CDN]
       ↓
[API Gateway (Next.js)]  →  [Auth0 / NextAuth]
       ↓                         
  ┌────┴────┐
  ↓         ↓
[SQS]   [DynamoDB - orders]
  ↓
[Worker Service (Lambda)]  →  [Stripe API]
  ↓                           [SendGrid API]
[DynamoDB - processed]
  ↓
[SNS → notification fan-out]
```

## Service Details

### API Gateway → Worker Service

- **Communication:** Async via SQS (`order-processing-queue`)
- **Data format:** JSON message with order ID and action type
- **Failure handling:** DLQ after 3 retries. DLQ alarm triggers PagerDuty.

### API Gateway → DynamoDB

- **Communication:** Direct SDK calls via `@aws-sdk/client-dynamodb`
- **Tables used:** `orders`, `users`, `sessions`
- **Access pattern:** Single-item lookups by primary key. No scans in hot paths.

### Worker Service → External APIs

- **Stripe:** Payment capture and refunds. Idempotency keys used for all writes.
- **SendGrid:** Transactional email. Template IDs stored in environment variables.

### Worker Service → SNS

- **Communication:** Publishes events to `order-events` topic
- **Subscribers:** Email notification Lambda, analytics pipeline, partner webhook dispatcher

## Shared Resources

- **DynamoDB:** Single account, per-environment table naming (`dev-orders`, `prod-orders`)
- **S3:** `uploads-bucket` for customer file uploads, `artifacts-bucket` for build outputs
- **CloudWatch:** All services log to CloudWatch. Log groups named `/app/{service-name}/{environment}`
